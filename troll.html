<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Analyse en cours...</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .progress-container {
            width: 60%;
            margin: 20px auto;
            border: 2px solid white;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            background: #333;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #ff7aa2, #ff0000);
            transition: width 0.1s linear;
        }

        #troll-image {
            display: none; 
            width: 250px;
            border-radius: 20px;
            margin: 10px auto;
            box-shadow: 0 0 20px rgba(255,0,0,0.5);
        }

        #status-text {
            font-size: 1.2em;
            margin-top: 10px;
        }

        #backBtn {
            display: none;
            position: fixed; 
            bottom: 20px;    
            left: 20px;      
            z-index: 1000;
            padding: 12px 20px;
            font-size: 16px;
            background: #ff7aa2;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body style="background:black; color:white; text-align:center; padding-top: 30px; margin: 0;">

    <audio id="troll-music">
        <source src="votre-musique-troll.mp3" type="audio/mpeg">
    </audio>

    <h2>Analyse de ton niveau de gentillesse...</h2>

    <img id="troll-image" src="troll.jpg" alt="Troll Face">

    <div class="progress-container">
        <div id="myBar" class="progress-bar"></div>
    </div>

    <p id="percentage">0%</p>
    <p id="status-text">Calcul des données en cours...</p>

    <button id="backBtn" onclick="location.href='index.html'">
        ⬅ Retour
    </button>

    <script>
        let width = 0;
        const bar = document.getElementById("myBar");
        const text = document.getElementById("percentage");
        const status = document.getElementById("status-text");
        const trollImg = document.getElementById("troll-image");
        const backBtn = document.getElementById("backBtn");
        const music = document.getElementById("troll-music"); // Récupère l'audio

        function move() {
            if (width >= 99) {
                width = 99;
                text.innerHTML = "99%...";
                bar.style.width = width + "%";
                
                status.innerHTML = "⚠️ Erreur critique : Trop de méchanceté détectée !";
                status.style.color = "red";
                
                // --- MODIFICATIONS ICI ---
                trollImg.style.display = "block"; 
                
                // Lancer la musique
                music.play().catch(error => {
                    console.log("Lecture bloquée par le navigateur, attend une interaction.");
                });
                // --------------------------
                
                setTimeout(() => {
                    backBtn.style.display = "block";
                }, 1000);

            } else {
                if (width < 30) width += 0.8;
                else if (width < 70) width += 0.4;
                else width += 0.1;

                text.innerHTML = Math.floor(width) + "%";
                bar.style.width = width + "%";

                if (width > 40 && width < 80) status.innerHTML = "Vérification de la patience...";
                if (width > 80) status.innerHTML = "Presque fini...";

                requestAnimationFrame(move);
            }
        }

        setTimeout(move, 500);
    </script>

</body>
</html>
